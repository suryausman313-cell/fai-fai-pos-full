<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Admin â€” FAI FAI POS</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="style.css">
</head>
<body><script>
function logout() {
    localStorage.removeItem("logged");
    alert("Logged Out Successfully");
    window.location.href = "login.html";
}
</script>
<header class="topbar"><h1>Admin Panel</h1></header>
<main style="padding:18px;display:grid;grid-template-columns:1fr 340px;gap:18px">
  <section>
    <div class="card">
      <h3>Add product</h3>
      <div class="form-row"><input id="pname" placeholder="Name"></div>
      <div class="form-row"><input id="pprice" placeholder="Price" type="number"></div>
      <div class="form-row"><input id="pcat" placeholder="Category"></div>
      <div class="form-row"><button id="addProd">Add product</button></div>
    </div>

    <div class="card" style="margin-top:12px">
      <h3>Products</h3>
      <div id="productList"></div>
    </div>
  </section>

  <aside>
    <div class="card">
      <h3>Store Settings</h3>
      <div class="form-row"><input id="storeName" placeholder="Store name"></div>
      <div class="form-row"><input id="currency" placeholder="Currency (AED)"></div>
      <div><button id="saveSettings">Save</button></div>
    </div>

    <div class="card" style="margin-top:12px">
      <h3>Import sample products</h3>
      <button id="importSample">Import sample (products.json)</button>
    </div>
  </aside>
</main>

<script src="app.js"></script>
<script>
function renderProducts(){
  const products = POSDB.getProducts();
  const el = document.getElementById('productList');
  if(!el) return;
  el.innerHTML = products.map(p=>`
    <div class="row product">
      <div style="flex:1;text-align:left"><strong>${p.name}</strong><div class="small">${p.cat}</div></div>
      <div style="text-align:right">${POSDB.fmtMoney(p.price)}<br>
        <button onclick="deleteProd('${p.id}')">Delete</button>
      </div>
    </div>
  `).join('');
}
function deleteProd(id){
  if(!confirm('Delete product?')) return;
  POSDB.setProducts(POSDB.getProducts().filter(x=>x.id!==id));
  renderProducts();
}
document.getElementById('addProd').addEventListener('click',async()=>{
  const name=document.getElementById('pname').value.trim();
  const price=parseFloat(document.getElementById('pprice').value)||0;
  const cat=document.getElementById('pcat').value.trim()||'General';
  if(!name) return alert('Name required');
  POSDB.addProduct({id:POSDB.uid('p'),name,price,cat});
  document.getElementById('pname').value=''; document.getElementById('pprice').value=''; document.getElementById('pcat').value='';
  renderProducts();
});
document.getElementById('importSample').addEventListener('click', async ()=>{
  try{
    const r = await fetch('products.json'); const data = await r.json();
    const db = POSDB.loadDB();
    data.forEach(p=>{
      if(!db.products.find(x=>x.name===p.name)) db.products.push(Object.assign({id:POSDB.uid('p')},p));
    });
    POSDB.saveDB(db);
    renderProducts();
    alert('Imported');
  }catch(e){ alert('Import failed'); console.error(e); }
});
document.getElementById('saveSettings').addEventListener('click',()=>{
  const db = POSDB.loadDB();
  db.settings.storeName = document.getElementById('storeName').value||db.settings.storeName;
  db.settings.currency = document.getElementById('currency').value||db.settings.currency;
  POSDB.saveDB(db);
  alert('Saved');
});
document.addEventListener('DOMContentLoaded',()=>{
  const db = POSDB.loadDB();
  document.getElementById('storeName').value = db.settings.storeName || '';
  document.getElementById('currency').value = db.settings.currency || 'AED';
  renderProducts();
});
</script>
</body><script>
  POS.protectPage("settings");
</script>
</html>
